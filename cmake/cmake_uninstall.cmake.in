if(NOT EXISTS "@CMAKE_BINARY_DIR@/install_manifest.txt")
    message(FATAL_ERROR "Cannot find install manifest: @CMAKE_BINARY_DIR@/install_manifest.txt")
endif()

file(READ "@CMAKE_BINARY_DIR@/install_manifest.txt" files)
string(REGEX REPLACE "\n" ";" files "${files}")

# Удаляем файлы
foreach(file ${files})
    message(STATUS "Uninstalling: $ENV{DESTDIR}${file}")
    if(EXISTS "$ENV{DESTDIR}${file}")
        execute_process(
            COMMAND ${CMAKE_COMMAND} -E remove "$ENV{DESTDIR}${file}"
            OUTPUT_VARIABLE rm_out
            RESULT_VARIABLE rm_retval
        )
        if(NOT "${rm_retval}" STREQUAL 0)
            message(FATAL_ERROR "Problem when removing: $ENV{DESTDIR}${file}")
        endif()
    else()
        message(STATUS "File: $ENV{DESTDIR}${file} does not exist.")
    endif()
endforeach()

# Удаляем пустые директории
get_filename_component(install_prefix "@CMAKE_INSTALL_PREFIX@" ABSOLUTE)
file(GLOB files "${install_prefix}/*")
if(NOT files)
    message(STATUS "Removing empty directory: ${install_prefix}")
    execute_process(
        COMMAND ${CMAKE_COMMAND} -E remove_directory "${install_prefix}"
    )
endif()